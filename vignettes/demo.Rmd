---
title: "A tutorial on Lipid Structure Enrichment Analysis (LSEA)"
output: rmarkdown::github_document
vignette: >
  %\VignetteIndexEntry{demo}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```
## load package and example data and perform clr transformation
```{r, warning = FALSE}
library(lsea)

data(comp_data)
data(labels)

#transform composition data (features x samples) using centered log-ratio transformation
# note: this is not for normalized abundance data!!
clr_data <- lsea::clr.transform(comp_data)
```
## perform differential composition analysis on clr-transformed data
```{r, warning = FALSE, message = FALSE}
# to perform a paired t-test (samples must be ordered by pair)
de_df <- lsea::two.group.row.test(clr_data, labels, test = "t", paired = TRUE)
# to perform unpaired wilcox test
# note: wilcox test will throw warnings for every row with ties, so suppress those warnings
w_df <- suppressWarnings(lsea::two.group.row.test(clr_data, labels, test = "w", paired = FALSE))
```
### inspect the results
t-test results
```{r, echo = FALSE}
knitr::kable(head(de_df))
```
Wilcoxon test results
```{r, echo = FALSE}
knitr::kable(head(w_df))
```

## lipid structure enrichment analysis
```{r, warning = FALSE, message = FALSE}
# we can use the t-statistic to rank lipid species and perform enrichment analysis using the GSEA algorithm
# note: the returned Wilcoxon statistic is not directional
res <- lsea::lsea(de_df, rnk_name = "stat")
```
Top 5 positive results
```{r, echo = FALSE}
knitr::kable(res[1:5,1:5])
```
Top 5 negative results
```{r, echo = FALSE}
knitr::kable(res[279:284,1:5])
```
### lipid species structure annotation
```{r}
# LSEA works by annotating the provided lipid species based on their LIPIDMAPS-style name
# and sorts them into multiple lipid sets based on class, tail length, and double bonds
lipid_anno <- lsea::annotate.lipid.species(rownames(de_df))
```

```{r, echo = FALSE}
knitr::kable(head(lipid_anno))
```

